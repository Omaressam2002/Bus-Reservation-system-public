<!DOCTYPE html>
<html lang="en">

<head>
	<title>Routes</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="description" content="Travelix Project">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" type="text/css" href="styles/bootstrap4/bootstrap.min.css">
	<link href="plugins/font-awesome-4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" type="text/css" href="styles/offers_styles.css">
	<link rel="stylesheet" type="text/css" href="styles/offers_responsive.css">
	<style>
		/* Optional: Ensure cards don't overflow and spacing is correct */
		#routesRow {
			margin-top: 30px;
		}

		.offers_item {
			margin-bottom: 40px;
		}
	</style>
</head>

<body>

	<div class="super_container">

		<!-- Header -->

		<header class="header">
			<!-- Top Bar -->
			<div class="top_bar">
				<div class="container">
					<div class="row">
						<div class="col d-flex flex-row">
							<div class="social">
								<ul class="social_list">
									<li class="social_list_item"><a href="#"><i class="fa fa-facebook"
												aria-hidden="true"></i></a></li>
									<li class="social_list_item"><a href="#"><i class="fa fa-twitter"
												aria-hidden="true"></i></a></li>
									<li class="social_list_item"><a href="#"><i class="fa fa-linkedin"
												aria-hidden="true"></i></a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Main Navigation -->
			<nav class="main_nav">
				<div class="container">
					<div class="row">
						<div class="col main_nav_col d-flex flex-row align-items-center justify-content-start">
							<div class="logo_container">
								<div class="logo"><a href="#"><img src="images/logo.png" alt="">GoBus</a></div>
							</div>
							<div class="main_nav_container ml-auto">
								<ul class="main_nav_list">
									<li class="main_nav_item"><a href="index.html">home</a></li>
									<li class="main_nav_item"><a href="#">routes</a></li>
									<li class="main_nav_item"><a href="contact.html">contact us</a></li>
								</ul>
							</div>
							<div class="content_search ml-lg-0 ml-auto"></div>
							<form id="search_form" class="search_form bez_1">
								<input type="search" class="search_content_input bez_1">
							</form>
							<div class="hamburger">
								<i class="fa fa-bars trans_200"></i>
							</div>
						</div>
					</div>
				</div>
			</nav>
		</header>

		<div class="menu trans_500">
			<div class="menu_content d-flex flex-column align-items-center justify-content-center text-center">
				<div class="menu_close_container">
					<div class="menu_close"></div>
				</div>
				<div class="logo menu_logo"><a href="#"><img src="images/logo.png" alt=""></a></div>
				<ul>
					<li class="menu_item"><a href="index.html">home</a></li>
					<li class="menu_item"><a href="#">routes</a></li>
					<li class="menu_item"><a href="contact.html">contact us</a></li>
				</ul>
			</div>
		</div>

		<!-- Home -->
		<div class="home">
			<div class="home_background parallax-window" data-parallax="scroll"
				data-image-src="images/about_background.jpg"></div>
			<div class="home_content">
				<div class="home_title">Ready to Ride?</div>
			</div>
		</div>

		<div class="offers">
			<div class="container">
				<div class="row">
					<div class="col-lg-1 temp_col"></div>
					<div class="col-lg-11">
						<!-- Offers Sorting -->
						<div class="offers_sorting_container">
							<label class="about_text">Sort by:</label>
							<select id="sortSelect" class="form-control" style="width: auto; display: inline-block;">
								<option value="">Default</option>
								<option value="price_asc">Price: Low to High</option>
								<option value="price_desc">Price: High to Low</option>
								<option value="source">Source City</option>
								<option value="destination">Destination City</option>
								<option value="tier">Bus Tier</option>
							</select>
						</div>
					</div>
					<div class="col-lg-12">
						<div class="offers_grid"></div>
						<div class="row" id="routesRow"></div>
					</div>
				</div>
			</div>
		</div>

		<!-- Footer -->
		<footer class="footer">
			<div class="container">
				<div class="row">
					<!-- Footer Column -->
					<div class="col-lg-3 footer_column">
						<div class="footer_col">
							<div class="footer_content footer_about">
								<div class="logo_container footer_logo">
									<div class="logo"><a href="#"><img src="images/logo.png" alt="">GoBus</a></div>
								</div>
								<p class="footer_about_text">We make group travel easy and comfortable. With modern
									buses, professional drivers, and flexible booking, your journey is safe and
									hassle-free. Ride with us for a smooth, reliable trip every time.</p>
								<ul class="footer_social_list">
									<li class="footer_social_item"><a href="#"><i class="fa fa-pinterest"></i></a></li>
									<li class="footer_social_item"><a href="#"><i class="fa fa-facebook-f"></i></a></li>
									<li class="footer_social_item"><a href="#"><i class="fa fa-twitter"></i></a></li>
								</ul>
							</div>
						</div>
					</div>
					<div class="col-lg-3 footer_column"></div>
					<div class="col-lg-3 footer_column">
						<div class="footer_col"></div>
					</div>
					<div class="col-lg-3 footer_column">
						<div class="footer_col">
							<div class="footer_title">contact info</div>
							<div class="footer_content footer_contact">
								<ul class="contact_info_list">
									<li class="contact_info_item d-flex flex-row">
										<div>
											<div class="contact_info_icon"><img src="images/placeholder.svg" alt="">
											</div>
										</div>
										<div class="contact_info_text">205 Ibrahimya Street, Alexandria, Egypt</div>
									</li>
									<li class="contact_info_item d-flex flex-row">
										<div>
											<div class="contact_info_icon"><img src="images/phone-call.svg" alt="">
											</div>
										</div>
										<div class="contact_info_text">+201234567899</div>
									</li>
									<li class="contact_info_item d-flex flex-row">
										<div>
											<div class="contact_info_icon"><img src="images/message.svg" alt=""></div>
										</div>
										<div class="contact_info_text"><a
												href="mailto:contactme@gmail.com?Subject=Hello"
												target="_top">gobus@gmail.com</a></div>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</footer>

		<!-- Copyright -->
		<div class="copyright">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 order-lg-1 order-2">
						<div class="copyright_content d-flex flex-row align-items-center">
							<div>
								Copyright &copy;
								<script>document.write(new Date().getFullYear());</script> All rights reserved | This
								template is made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a
									href="https://colorlib.com" target="_blank">Colorlib</a>
							</div>
						</div>
					</div>
					<div class="col-lg-9 order-lg-2 order-1">
						<div class="footer_nav_container d-flex flex-row align-items-center justify-content-lg-end">
							<div class="footer_nav">
								<ul class="footer_nav_list">
									<li class="footer_nav_item"><a href="index.html">home</a></li>
									<li class="footer_nav_item"><a href="#">routes</a></li>
									<li class="footer_nav_item"><a href="contact.html">contact us</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="js/jquery-3.2.1.min.js"></script>
	<script src="styles/bootstrap4/popper.js"></script>
	<script src="styles/bootstrap4/bootstrap.min.js"></script>
	<script src="plugins/Isotope/isotope.pkgd.min.js"></script>
	<script src="plugins/easing/easing.js"></script>
	<script src="plugins/parallax-js-master/parallax.min.js"></script>
	<script src="js/offers_custom.js"></script>
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const row = document.getElementById("routesRow");
			let routesData = [];

			function renderRoutes(routes) {
				row.innerHTML = "";
				const seenTripIds = new Set();
				routes.forEach(route => {
					const tripId = route.trip_id;
					if (!tripId || seenTripIds.has(tripId)) return;
					seenTripIds.add(tripId);

					const card = `
						<div class="offers_item rating_4">
							<div class="row">
								<div class="col-lg-1 temp_col"></div>
								<div class="col-lg-3 col-1680-4">
									<div class="offers_image_container">
										<div class="offers_image_background" style="background-image:url(images/route2.jpg)"></div>
										<div class="offer_name"><a href="#">${route.tier ?? 'N/A'}</a></div>
									</div>
								</div>
								<div class="col-lg-8">
									<div class="offers_content">
										<div class="offers_price">$${route.trip_price ?? 'N/A'}<span>per person</span></div>
										<p class="offers_text">Source: ${route.source ?? 'N/A'} | Destination: ${route.destination ?? 'N/A'}</p>
										<p class="offers_text">Departure Time: ${route.departure_time ?? 'N/A'} | Arrival Time: ${route.arrival_time ?? 'N/A'}</p>
										<p class="offers_text">Trip Date: ${route.trip_date ?? 'N/A'}</p>
										<p class="offers_text">Available Seats: ${route.available_seats ?? 'N/A'}/${route.total_seats ?? 'N/A'}</p>
										<div class="button book_button">
											<a href="services.html?trip_id=${tripId}">Reserve<span></span><span></span><span></span></a>
										</div>
									</div>
								</div>
							</div>
						</div>`;
					row.innerHTML += card;
				});
				if (seenTripIds.size === 0) {
					row.innerHTML = "<div class='col-12'><p>No valid route found for this trip.</p></div>";
				}
			}

			function sortRoutes(criteria) {
				let sorted = [...routesData];
				switch (criteria) {
					case "price_asc":
						sorted.sort((a, b) => a.trip_price - b.trip_price);
						break;
					case "price_desc":
						sorted.sort((a, b) => b.trip_price - a.trip_price);
						break;
					case "source":
						sorted.sort((a, b) => a.source.localeCompare(b.source));
						break;
					case "destination":
						sorted.sort((a, b) => a.destination.localeCompare(b.destination));
						break;
					case "tier":
						sorted.sort((a, b) => (a.tier || '').localeCompare(b.tier || ''));
						break;
				}
				renderRoutes(sorted);
			}

			document.getElementById("sortSelect").addEventListener("change", function () {
				sortRoutes(this.value);
			});

			const params = new URLSearchParams(window.location.search);
			const tripId = params.get("trip_id");
			const url = tripId ? `/api/routes?trip_id=${tripId}` : "/api/routes";

			fetch(url)
				.then(res => res.json())
				.then(data => {
					routesData = Array.isArray(data) ? data : [data];
					renderRoutes(routesData);
				})
				.catch(err => {
					row.innerHTML = "<div class='col-12'><p>Error loading route.</p></div>";
					console.error("Failed to load route:", err);
				});
		});
	</script>

</body>

</html>